<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Le Voile du Manoir ‚Äî √ânigme Finale</title>
<meta name="description" content="Trouve les 5 cl√©s dans l'ordre pour lever le voile et r√©v√©ler la photo." />
<style>
  :root{
    --bg:#0e0f11; --panel:rgba(255,255,255,0.03); --accent:#86c08a;
    --text:#eee; --muted:#bdbdbd; --ok:#55d67a; --warn:#ffba4a; --err:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Arial,sans-serif; background:radial-gradient(1200px 700px at 50% -10%, #1a1b1e, #0b0c0e 70%); color:var(--text)}
  
  .wrap{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px}
  
  /* Mobile-first design */
  .card{
    width:100%; 
    max-width:420px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2)); 
    border:1px solid rgba(255,255,255,0.06); 
    border-radius:16px; 
    box-shadow:0 18px 60px rgba(0,0,0,0.55); 
    overflow:hidden;
  }
  
  .image-section{
    position:relative;
    height:50vh;
    min-height:280px;
    max-height:400px;
    background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.32));
    display:flex;
    align-items:center;
    justify-content:center;
    padding:16px;
  }
  
  .frame{
    width:100%; 
    height:100%; 
    border-radius:12px; 
    overflow:hidden; 
    background:#111; 
    position:relative; 
    display:flex; 
    align-items:center; 
    justify-content:center;
  }
  
  .frame img{
    width:100%; 
    height:100%; 
    object-fit:contain; 
    display:block; 
    transition:filter 650ms ease, transform 650ms ease; 
    filter: blur(30px) brightness(.78) contrast(.98);
  }
  
  .badge-top{
    position:absolute; 
    left:14px; 
    top:14px; 
    background:rgba(0,0,0,0.7); 
    padding:6px 10px; 
    border-radius:20px; 
    font-size:12px; 
    font-weight:600;
  }
  
  .content{padding:24px 20px}
  
  h1{margin:0 0 8px; font-size:20px; letter-spacing:.4px; text-align:center}
  .lead{margin:0 0 20px; color:#d9d9d9; text-align:center; font-size:14px}
  
  .current-step{
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.1);
    border-radius:12px;
    padding:16px;
    margin-bottom:20px;
  }
  
  .step-number{
    color:var(--accent);
    font-weight:600;
    font-size:14px;
    margin-bottom:8px;
  }
  
  .riddle{
    font-size:16px;
    line-height:1.4;
    margin-bottom:16px;
    color:#f5f5f5;
  }
  
  .controls{display:flex; gap:8px; margin-bottom:16px}
  
  input[type="text"]{
    flex:1; 
    padding:12px 14px; 
    border-radius:10px; 
    border:1px solid rgba(255,255,255,0.1); 
    background:rgba(255,255,255,0.05); 
    color:var(--text); 
    outline:none;
    font-size:16px;
  }
  
  input::placeholder{color:#9aa0a6}
  input:focus{border-color:var(--accent); box-shadow:0 0 0 2px rgba(134,192,138,0.2)}
  
  button{
    padding:12px 16px; 
    border-radius:10px; 
    border:1px solid rgba(255,255,255,0.08); 
    background:#313336; 
    color:#fff; 
    cursor:pointer;
    font-size:14px;
    font-weight:500;
    transition:all 0.2s ease;
  }
  
  button:hover{background:#404348}
  button:active{transform:scale(0.98)}
  
  button.primary{
    background:var(--accent); 
    color:#08270f; 
    font-weight:600; 
    border-color:transparent;
  }
  
  button.primary:hover{background:#9cd5a0}
  
  .feedback{
    min-height:40px; 
    font-size:14px; 
    line-height:1.4;
    padding:8px 0;
  }
  
  .ok{color:var(--ok)} 
  .warn{color:var(--warn)} 
  .err{color:var(--err)}
  
  .progress-grid{
    display:grid; 
    grid-template-columns:repeat(5, 1fr); 
    gap:8px; 
    margin:20px 0;
  }
  
  .progress-item{
    aspect-ratio:1;
    border:2px solid rgba(255,255,255,0.1);
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:12px;
    font-weight:600;
    transition:all 0.3s ease;
  }
  
  .progress-item.completed{
    background:var(--ok);
    border-color:var(--ok);
    color:#0a3d14;
  }
  
  .progress-item.current{
    border-color:var(--accent);
    background:rgba(134,192,138,0.1);
  }
  
  .overlay-final{
    position:absolute; 
    inset:0; 
    display:none; 
    align-items:center; 
    justify-content:center; 
    background:linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.4) 60%, rgba(0,0,0,0.8)); 
    color:#fff; 
    text-align:center; 
    padding:24px;
  }
  
  .overlay-final .title{font-size:18px; margin-bottom:10px; font-weight:600}
  .overlay-final .subtitle{font-size:14px; color:#ccc; margin-bottom:16px}
  .overlay-final .download{
    padding:12px 20px; 
    border-radius:8px; 
    background:var(--accent); 
    color:#08270f; 
    font-weight:700; 
    border:none; 
    cursor:pointer;
    font-size:14px;
  }
  
  /* Tablet et Desktop */
  @media (min-width:768px){
    .wrap{padding:28px}
    .card{
      max-width:900px;
      display:grid;
      grid-template-columns:1fr 1.2fr;
    }
    .image-section{height:auto; min-height:500px}
    .content{padding:32px 28px}
    h1{font-size:24px; text-align:left}
    .lead{text-align:left; font-size:15px}
    .riddle{font-size:17px}
  }
  
  @media (min-width:1024px){
    .card{max-width:1100px}
    .content{padding:36px 32px}
  }
  
  /* Am√©lioration tactile */
  @media (hover: none) and (pointer: coarse) {
    button, input{min-height:44px}
    .frame{touch-action:none}
  }
  
  /* Animation d'erreur plus douce */
  .shake{
    animation:shake 0.4s ease-in-out;
  }
  
  @keyframes shake{
    0%, 100%{transform:translateX(0)}
    25%{transform:translateX(-4px)}
    75%{transform:translateX(4px)}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-labelledby="title">
      
      <div class="image-section">
        <div class="frame" aria-hidden="false">
          <div class="badge-top">Voile : <span id="stage">5/5</span></div>
          <img id="revealImg" src="./dracula_revelation.png" alt="Le visage cach√© du Manoir" />
          <div class="overlay-final" id="finalOverlay" aria-hidden="true">
            <div>
              <div class="title">‚úÖ R√©v√©lation compl√®te !</div>
              <div class="subtitle">Le myst√®re du Manoir est enfin d√©voil√©...</div>
              <button class="download" id="dlBtn" type="button">T√©l√©charger l'image</button>
            </div>
          </div>
        </div>
      </div>

      <div class="content">
        <h1 id="title">Le Voile du Manoir</h1>

        <div class="current-step" id="currentStep">
          <div class="step-number" id="stepNumber">Mot 1/5</div>
          <div class="riddle" id="currentRiddle">Premier mot recherch√© dans le message...</div>
        </div>

        <div class="controls" aria-live="polite">
          <input id="pwd" autocomplete="off" spellcheck="false" placeholder="Mot du message de  Gary, Ben et Dracula..." />
          <button id="tryBtn" class="primary">Valider</button>
        </div>
        
        <button id="hintBtn" style="width:100%; margin-bottom:16px; background:rgba(255,255,255,0.05)">Afficher l'indice</button>
        
        <div id="feedback" class="feedback">Cherchez le premier mot dans le message de  Gary, Ben et Dracula que vous avez lu.</div>

        <div class="progress-grid" id="progressGrid">
          <!-- G√©n√©r√© par JS -->
        </div>
      </div>

    </div>
  </div>

<script>
(function(){
  // 5 mots √† trouver dans le texte de remerciement + indices optionnels
  const STEPS = [
    { 
      key:'souffle',
      hint:'üí° Indice : Je suis invisible, mais je fais danser les flammes...'
    },
    { 
      key:'rire',
      hint:'üí° Indice : On ne m\'entend pas mais on me partage, j\'√©clate de joie...'
    },
    { 
      key:'trace',
      hint:'üí° Indice : Je reste quand tout est pass√©, je marque les murs...'
    },
    { 
      key:'voile',
      hint:'üí° Indice : Je cache la v√©rit√©, on me l√®ve pour voir...'
    },
    { 
      key:'ombre',
      hint:'üí° Indice : Je nais de la lumi√®re mais m\'y cache...'
    }
  ];

  const MAX_STAGE = STEPS.length;
  let stage = MAX_STAGE;
  const img = document.getElementById('revealImg');
  const stageLabel = document.getElementById('stage');
  const feedback = document.getElementById('feedback');
  const input = document.getElementById('pwd');
  const tryBtn = document.getElementById('tryBtn');
  const hintBtn = document.getElementById('hintBtn');
  const overlay = document.getElementById('finalOverlay');
  const dlBtn = document.getElementById('dlBtn');
  const stepNumber = document.getElementById('stepNumber');
  const currentRiddle = document.getElementById('currentRiddle');
  const progressGrid = document.getElementById('progressGrid');

  // Niveaux de flou selon le stage
  const blurLevels = [0, 6, 12, 18, 24, 30];

  // Initialisation
  init();

  function init(){
    // Cr√©er la grille de progression
    for(let i = 0; i < STEPS.length; i++){
      const item = document.createElement('div');
      item.className = 'progress-item';
      item.textContent = i + 1;
      item.id = 'progress_' + i;
      progressGrid.appendChild(item);
    }
    
    updateVisual();
    updateUI();
    input.focus();
  }

  // √âv√©nements
  tryBtn.addEventListener('click', onTry);
  input.addEventListener('keydown', (e)=>{ 
    if(e.key === 'Enter'){ 
      onTry(); 
    }
  });

  hintBtn.addEventListener('click', ()=>{
    const currentIndex = STEPS.length - stage;
    if(currentIndex < STEPS.length){
      feedback.innerHTML = `<span class="warn">${STEPS[currentIndex].hint}</span>`;
    }
  });

  // T√©l√©chargement
  dlBtn.addEventListener('click', ()=>{
    const a = document.createElement('a');
    a.href = img.currentSrc || img.src; 
    a.download = 'revelation_dracula.png';
    document.body.appendChild(a); 
    a.click(); 
    a.remove();
  });

  // Gestion erreur image
  img.addEventListener('error', ()=>{
    const warn = document.createElement('div');
    warn.style.cssText="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#1a1a1acc;color:#fff;padding:20px;text-align:center;font-size:14px;line-height:1.4";
    warn.innerHTML="‚ö†Ô∏è Image introuvable<br>Placez 'dracula_revelation.png' dans le m√™me dossier";
    img.closest('.frame').appendChild(warn);
  });

  function onTry(){
    const raw = input.value;
    const val = normalize(raw);
    input.value='';

    const expectedIndex = STEPS.length - stage;
    const expected = STEPS[expectedIndex]?.key;

    if(!val){ 
      feedback.innerHTML = `<span class="warn">‚ö†Ô∏è Entrez votre r√©ponse d'abord.</span>`; 
      return; 
    }
    
    if(!expected){ 
      feedback.textContent = "Tout est d√©j√† r√©v√©l√©."; 
      return; 
    }

    if(val === expected){
      markCompleted(expectedIndex);
      if(stage > 0){ stage--; }
      updateVisual(); 
      updateUI();

      if(stage === 0){
        feedback.innerHTML = `<span class="ok">‚úÖ <strong>Parfait !</strong> Tous les mots trouv√©s !</span>`;
        overlay.style.display = "flex";
        // Animation finale
        setTimeout(() => {
          img.style.transform = 'scale(1)';
        }, 300);
      } else {
        feedback.innerHTML = `<span class="ok">‚úÖ <strong>Correct !</strong> Mot ${expectedIndex+1}/5 trouv√© : "${expected}"</span>`;
      }
    } else {
      feedback.innerHTML = `<span class="err">‚ùå Mauvaise r√©ponse. R√©essayez !</span>`;
      document.querySelector('.card').classList.add('shake');
      setTimeout(() => {
        document.querySelector('.card').classList.remove('shake');
      }, 400);
    }
    
    // Focus pour mobile
    if(stage > 0){
      setTimeout(() => input.focus(), 100);
    }
  }

  function markCompleted(index){
    const item = document.getElementById('progress_' + index);
    if(item) {
      item.classList.add('completed');
      item.textContent = '‚úì';
    }
  }

  function updateVisual(){
    if(stage < 0) stage = 0;
    if(stage > MAX_STAGE) stage = MAX_STAGE;
    
    const blur = blurLevels[stage] ?? 0;
    const bright = 0.78 + (MAX_STAGE - stage) * 0.04;
    
    img.style.filter = `blur(${blur}px) brightness(${bright}) contrast(.98)`;
    stageLabel.textContent = `${stage}/${MAX_STAGE}`;
    
    overlay.style.display = (stage === 0) ? "flex" : "none";
  }

  function updateUI(){
    const nextIndex = STEPS.length - stage;
    
    if(stage === 0){
      // Jeu termin√© - masquer les contr√¥les
      document.querySelector('.current-step').style.display = 'none';
      document.querySelector('.controls').style.display = 'none';
      hintBtn.style.display = 'none';
      return;
    }
    
    if(nextIndex < STEPS.length){
      stepNumber.textContent = `Mot ${nextIndex + 1}/${STEPS.length}`;
      currentRiddle.textContent = `Cherchez le mot n¬∞${nextIndex + 1} dans le message de  Gary, Ben et Dracula...`;
      
      // Mise √† jour des indicateurs de progression
      for(let i = 0; i < STEPS.length; i++){
        const item = document.getElementById('progress_' + i);
        if(!item) continue;
        
        item.classList.remove('current');
        if(i === nextIndex && stage > 0){
          item.classList.add('current');
        }
      }
    }
  }

  function normalize(s){
    return (s||'').toLowerCase().trim().replace(/\s+/g,'');
  }
})();
</script>
</body>
</html>
