<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Le Voile du Manoir ‚Äî √ânigme Finale</title>
<meta name="description" content="Entrez les 5 mots de passe, dans l'ordre du message de remerciement, pour lever le voile et r√©v√©ler l'image finale." />
<style>
  :root{
    --bg:#0e0f11;
    --panel:rgba(255,255,255,0.03);
    --accent:#86c08a;
    --text:#eee;
    --muted:#bdbdbd;
  }
  * { box-sizing: border-box; }
  html,body{height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Arial,sans-serif; background:radial-gradient(1200px 700px at 50% -10%, #1a1b1e, #0b0c0e 70%); color:var(--text);}
  .wrap{min-height:100%; display:flex; align-items:center; justify-content:center; padding:28px;}
  .card{
    width:min(1024px,96%);
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));
    border:1px solid rgba(255,255,255,0.06);
    border-radius:16px; box-shadow:0 18px 60px rgba(0,0,0,0.55);
    overflow:hidden; display:grid; grid-template-columns:1.1fr 0.9fr;
  }
  .left{padding:28px 28px 22px; display:flex; flex-direction:column; gap:14px;}
  h1{margin:0 0 4px; font-size:22px; letter-spacing:.4px}
  .lead{margin:0; color:#d9d9d9; line-height:1.5}
  .rules{margin:0; font-size:13px; color:var(--muted)}
  .controls{margin-top:6px; display:flex; gap:8px; align-items:center;}
  input[type="text"]{
    flex:1; padding:11px 12px; border-radius:10px;
    border:1px solid rgba(255,255,255,0.08);
    background:rgba(255,255,255,0.03); color:var(--text); outline:none;
  }
  input[type="text"]::placeholder{color:#9aa0a6}
  button{
    padding:11px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.08);
    background:#313336; color:#fff; cursor:pointer;
  }
  button.primary{background:var(--accent); color:#08270f; font-weight:600; border-color:transparent}
  .feedback{min-height:22px; font-size:14px; color:#d8d8d8; margin-top:6px}
  .progressline{display:flex; gap:6px; align-items:center; margin-top:6px}
  .pill{font-size:12px; color:#0b2b12; background:var(--accent); padding:6px 10px; border-radius:999px; font-weight:600}
  .muted{font-size:12px; color:var(--muted)}
  .right{background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.32)); display:flex; align-items:center; justify-content:center; position:relative; padding:16px;}
  .frame{
    width:min(430px,92%); height:560px; border-radius:12px; overflow:hidden; background:#111;
    position:relative; display:flex; align-items:center; justify-content:center;
  }
  .frame img{
    width:100%; height:100%; object-fit:cover; display:block;
    transition:filter 650ms ease, transform 650ms ease; transform:scale(1.02);
    filter: blur(30px) brightness(.78) contrast(.98);
  }
  .badge{position:absolute; left:14px; top:14px; background:rgba(0,0,0,0.45); color:#fff; padding:6px 10px; border-radius:999px; font-size:13px; backdrop-filter: blur(4px)}
  .overlay-final{
    position:absolute; inset:0; display:none; align-items:center; justify-content:center;
    background:linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.35) 65%, rgba(0,0,0,0.6) 100%);
    color:#fff; text-align:center; padding:24px;
  }
  .overlay-final .title{font-size:18px; margin-bottom:10px}
  .overlay-final .download{margin-top:10px; padding:10px 12px; border-radius:8px; background:var(--accent); color:#08270f; font-weight:700; border:none; cursor:pointer}
  .sep{height:1px; background:rgba(255,255,255,0.06); margin:8px 0}
  .small{font-size:12px; color:#cfcfcf}
  .list{margin:0; padding-left:16px}
  .list li{margin:4px 0}
  @media (max-width:960px){ .card{grid-template-columns:1fr} .right{order:-1} .frame{height:360px}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-labelledby="title">
      <div class="left">
        <h1 id="title">Le Voile du Manoir ‚Äî √ânigme Finale</h1>
        <p class="lead">
          Le message de remerciement contient <strong>cinq cl√©s</strong>. Entrez-les <em>dans l‚Äôordre</em> pour lever le voile et r√©v√©ler l‚Äôimage finale.
        </p>
        <p class="rules">
          Format attendu : tout en minuscules, sans accent ni espace. Les cl√©s sont des mots exacts tir√©s du texte (ex. <code>souffle</code>).
        </p>

        <div class="controls" aria-live="polite">
          <input id="pwd" autocomplete="off" spellcheck="false" placeholder="Entrez le mot de passe‚Ä¶" />
          <button id="tryBtn">Essayer</button>
          <button id="hintBtn" class="primary">Indice</button>
        </div>

        <div class="feedback" id="feedback">Trouvez la cl√© 1/5 dans la premi√®re ligne du message.</div>

        <div class="progressline">
          <span class="pill" id="pill">Cl√© 1/5</span>
          <span class="muted">Chaque bonne cl√© r√©duit le flou jusqu'√† la r√©v√©lation compl√®te.</span>
        </div>

        <div class="sep"></div>
        <div class="small">
          <details>
            <summary>Rappel ‚Äî Message de remerciement</summary>
            <ul class="list">
              <li>Ben, Gary & Dracula ‚Äî un seul souffle noir pour trois mercis.</li>
              <li>Merci d‚Äôavoir jou√© le jeu, d‚Äôavoir r√©pondu aux appels des t√©n√®bres et d‚Äôavoir illumin√© nos journ√©es de vos rires.</li>
              <li>Vous nous avez offert de vrais beaux moments. On a appris √† vous conna√Ætre un peu plus ‚Äî et quel d√©licieux m√©lange de douceur, de piquant et de folie vous formez.</li>
              <li>Chaque d√©fi, chaque rire, chaque moment pass√© ensemble a laiss√© une trace, douce ou piquante, sur les murs du Manoir.</li>
              <li>Mais le jeu n‚Äôest pas encore tout √† fait termin√©. Car c‚Äôest en r√©solvant cette ultime √©nigme que vous l√®verez enfin le voile. Oui, c‚Äôest ici que vous d√©couvrirez qui se cache dans l‚Äôombre, qui murmure encore entre les murs, qui berce le rire et l‚Äôeffroi.</li>
              <li>Avec une gorg√©e d‚Äô√©motion et un soup√ßon de sang-froid, ‚Äî Ben, Gary & Dracula ü©∏</li>
            </ul>
          </details>
        </div>
      </div>

      <div class="right">
        <div class="frame" aria-hidden="false">
          <div class="badge">Voile : <span id="stage">5/5</span></div>
          <!-- ‚ö†Ô∏è Place ton image dans le m√™me dossier et v√©rifie le nom -->
          <img id="revealImg" src="./dracula_revelation.png" alt="Le visage cach√© du Manoir" />
          <div class="overlay-final" id="finalOverlay" aria-hidden="true">
            <div>
              <div class="title">La v√©rit√© est l√†. Le voile est tomb√©.</div>
              <button class="download" id="dlBtn" type="button">T√©l√©charger l‚Äôimage</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
(function(){
  // Les 5 cl√©s, dans l'ordre du texte
  const TARGETS = ['souffle','rire','trace','voile','ombre'];
  const HINTS = [
    "Cherche dans l‚Äôouverture : ¬´ un seul souffle noir‚Ä¶ ¬ª",
    "Dans la phrase des rires et des journ√©es illumin√©es.",
    "L√† o√π le Manoir garde m√©moire de vous : la‚Ä¶",
    "Ce qui se l√®ve quand la v√©rit√© approche.",
    "L‚Äôultime refuge de Dracula."
  ];

  const MAX_STAGE = TARGETS.length; // 5
  let stage = MAX_STAGE;            // 5 ‚Üí 0
  const img = document.getElementById('revealImg');
  const stageLabel = document.getElementById('stage');
  const pill = document.getElementById('pill');
  const feedback = document.getElementById('feedback');
  const input = document.getElementById('pwd');
  const tryBtn = document.getElementById('tryBtn');
  const hintBtn = document.getElementById('hintBtn');
  const overlay = document.getElementById('finalOverlay');
  const dlBtn = document.getElementById('dlBtn');

  // Niveaux de flou (px) selon le stage (index = stage courant)
  const blurLevels = [0, 6, 12, 18, 24, 30];

  // Init
  updateVisual();
  updateUI();

  // Handler bouton "Essayer"
  tryBtn.addEventListener('click', onTry);
  input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ onTry(); }});

  // Handler indice
  hintBtn.addEventListener('click', ()=>{
    const idx = TARGETS.length - stage; // prochaine cl√© attendue
    const safeIdx = Math.max(0, Math.min(HINTS.length - 1, idx));
    feedback.textContent = "Indice : " + HINTS[safeIdx];
  });

  // T√©l√©chargement de l'image r√©v√©l√©e
  dlBtn.addEventListener('click', ()=>{
    const a = document.createElement('a');
    a.href = img.currentSrc || img.src;
    a.download = 'revelation_dracula.png';
    document.body.appendChild(a);
    a.click();
    a.remove();
  });

  // Gestion de l'image introuvable
  img.addEventListener('error', ()=>{
    const warn = document.createElement('div');
    warn.style.cssText = "position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#1a1a1acc;color:#fff;padding:20px;text-align:center";
    warn.textContent = "Image introuvable : place 'dracula_revelation.png' dans le m√™me dossier que 'revelation.html' (nom et extension EXACTS).";
    img.closest('.frame').appendChild(warn);
  });

  function onTry(){
    const raw = input.value;
    const val = normalize(raw);
    input.value = '';
    input.focus();

    // prochaine cl√© attendue
    const expectedIndex = TARGETS.length - stage;
    const expected = TARGETS[expectedIndex];

    if(!val){
      feedback.textContent = "Entrez d‚Äôabord un mot.";
      return;
    }

    if(val === expected){
      if(stage > 0){
        stage--; // on l√®ve un cran
        updateVisual();
        updateUI();
        if(stage === 0){
          feedback.textContent = "Parfait. La v√©rit√© est r√©v√©l√©e.";
          overlay.style.display = "flex";
        } else {
          const rest = stage;
          feedback.textContent = `Bien jou√©. Il reste ${rest} cl√©${rest>1?'s':''} √† trouver.`;
        }
      } else {
        feedback.textContent = "La photo est d√©j√† totalement r√©v√©l√©e.";
      }
    } else {
      feedback.textContent = "Rien ne bouge. Ce n‚Äôest pas la bonne cl√©.";
      // petit shake dramatique
      document.querySelector('.card').animate(
        [{transform:'translateX(0)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],
        {duration:420, iterations:1}
      );
    }
  }

  function updateVisual(){
    // clamp
    if(stage < 0) stage = 0;
    if(stage > MAX_STAGE) stage = MAX_STAGE;

    const blur = blurLevels[stage] ?? 0;
    const bright = 0.78 + (MAX_STAGE - stage) * 0.04; // petit √©claircissement progressif
    img.style.filter = `blur(${blur}px) brightness(${bright}) contrast(.98)`;
    stageLabel.textContent = `${stage}/${MAX_STAGE}`;
    overlay.style.display = (stage === 0) ? "flex" : "none";
  }

  function updateUI(){
    const nextIndex = TARGETS.length - stage;
    const nextHuman = Math.min(nextIndex + 1, TARGETS.length);
    pill.textContent = `Cl√© ${nextHuman}/${TARGETS.length}`;
    if(stage > 0){
      // prochaine cl√© √† deviner ‚Üí hint l√©ger
      feedback.textContent = `Trouvez la cl√© ${nextHuman}/${TARGETS.length} dans l‚Äôordre du message.`;
    }
  }

  // normalisation basique
  function normalize(s){
    return (s || '')
      .toLowerCase()
      .trim()
      .replace(/\s+/g,''); // aucun espace autoris√©
  }
})();
</script>
</body>
</html>
